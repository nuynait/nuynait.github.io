<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Swift 4 Codable · Tianyun Shan</title><meta name="description" content="Swift 4 Codable - Tianyun Shan"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/img.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.jerryshan.com/atom.xml" title="Tianyun Shan"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/img.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">Swift 4 Codable</h1><div class="post-info">Feb 9, 2019</div><div class="post-content"><p>Swift4 makes JSON serialization easier than ever. If you want an object to be encodable, Adapt to <code>Encodable</code>  protocols. If you want an object to be decodable, adapt to <code>Decodable</code> protocols. <code>Codable</code> protocols is for objects that both encodable and decodable.</p>
<span id="more"></span>

<h1 id="Automatic-Encoding-and-Decoding"><a href="#Automatic-Encoding-and-Decoding" class="headerlink" title="Automatic Encoding and Decoding"></a>Automatic Encoding and Decoding</h1><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Employee</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now this class can be serialize or deserialize to JSON. Isn’t that convenient?  Also if you have an object as a property inside another object, conform to <code>Codable</code> too.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Employee</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">    <span class="keyword">var</span> salary: <span class="type">Salary</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Salary</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> amount: int</span><br><span class="line">    <span class="keyword">var</span> tax: <span class="type">Int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The above class can also be serialize or deserialize to JSON.</p>
<h1 id="Encoder-and-Decoder"><a href="#Encoder-and-Decoder" class="headerlink" title="Encoder and Decoder"></a>Encoder and Decoder</h1><p><code>Encoder</code> works to turn <code>Encodable</code> objects to JSON serialized string. <code>Decoder</code> works to turn JSON serialized string into <code>Decodable</code> objects.</p>
<p><strong>Here is how you encode:</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> jsonEncoder <span class="operator">=</span> <span class="type">JSONEncoder</span>()</span><br><span class="line"><span class="keyword">let</span> jsonData <span class="operator">=</span> <span class="keyword">try</span> jsonEncoder.encode(object)</span><br><span class="line"><span class="keyword">let</span> jsonString <span class="operator">=</span> <span class="type">String</span>(data: jsonData, encoding: .utf8)</span><br></pre></td></tr></table></figure>

<p><strong>Here is how you decode:</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> jsonDecoder <span class="operator">=</span> <span class="type">JSONDecoder</span>()</span><br><span class="line"><span class="keyword">let</span> object <span class="operator">=</span> <span class="keyword">try</span> jsonDecoder.decode(<span class="type">Object</span>.<span class="keyword">self</span>, from: object)</span><br></pre></td></tr></table></figure>

<h1 id="Renaming-Properties-With-CodingKeys"><a href="#Renaming-Properties-With-CodingKeys" class="headerlink" title="Renaming Properties With CodingKeys"></a>Renaming Properties With CodingKeys</h1><p>If you want to have different keys then your property name in your serialized string, you will have to implement a CodingKey enum. Note that you will need to include all properties in the enum even if you don’t plan to rename all of them.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Employee</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">var</span> salary: <span class="type">Salary</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">CodingKeys</span>: <span class="title">String</span>, <span class="title">CodingKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> id <span class="operator">=</span> <span class="string">&quot;employeeId&quot;</span></span><br><span class="line">    <span class="keyword">case</span> name</span><br><span class="line">    <span class="keyword">case</span> salary</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Manual-Encoding-and-Decoding"><a href="#Manual-Encoding-and-Decoding" class="headerlink" title="Manual Encoding and Decoding"></a>Manual Encoding and Decoding</h1><p>If in some case you want to alter the structure of the <code>JSON</code> not just rename the properties, you will need to write your own encoding and decoding logic.</p>
<p>For example, you don’t want to have the following  <code>JSON</code>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Jerry&quot;</span></span><br><span class="line">  <span class="string">&quot;employeeId&quot;</span>: <span class="number">763246</span></span><br><span class="line">  <span class="string">&quot;salary&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;amount&quot;</span>: <span class="number">85000</span></span><br><span class="line">    <span class="string">&quot;tax&quot;</span>: <span class="number">25000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Instead you want the following <code>JSON</code>:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Jerry&quot;</span></span><br><span class="line">  <span class="string">&quot;employeeId&quot;</span>: <span class="number">763246</span></span><br><span class="line">  <span class="string">&quot;amount&quot;</span>: <span class="number">85000</span></span><br><span class="line">  <span class="string">&quot;tax&quot;</span>: <span class="number">25000</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You will have to change the following in <code>CodingKeys</code>, the key enum case contains the key for the json. So you need to add <code>case amount</code> and <code>case tax</code> since they are both the key to the serialized string.</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Employee</span>: <span class="title">Codable</span> </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">  <span class="keyword">var</span> id: <span class="type">Int</span></span><br><span class="line">  <span class="keyword">var</span> salary: <span class="type">Salary</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">enum</span> <span class="title">CodingKeys</span>: <span class="title">String</span>, <span class="title">CodingKey</span> </span>&#123;</span><br><span class="line">    <span class="keyword">case</span> id <span class="operator">=</span> <span class="string">&quot;employeeId&quot;</span></span><br><span class="line">    <span class="keyword">case</span> name</span><br><span class="line">    <span class="keyword">case</span> amount</span><br><span class="line">    <span class="keyword">case</span> tax</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>For encode:</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Employee</span>: <span class="title">Encodable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">func</span> <span class="title">encode</span>(<span class="params">to</span> <span class="params">encoder</span>: <span class="type">Encoder</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> container <span class="operator">=</span> encoder.container(keyedBy: <span class="type">CodingKeys</span>.<span class="keyword">self</span>)</span><br><span class="line">    <span class="keyword">try</span> container.encode(name, forKey: .name)</span><br><span class="line">    <span class="keyword">try</span> container.encode(id, forKey: .id)</span><br><span class="line">    <span class="keyword">try</span> container.encode(salary.amount, forKey: .amount)</span><br><span class="line">    <span class="keyword">try</span> container.encode(salary.tax, forKey: .tax)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>For decode</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">extension</span> <span class="title">Employee</span>: <span class="title">Decodable</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">init</span>(<span class="params">from</span> <span class="params">decoder</span>: <span class="type">Decoder</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> container <span class="operator">=</span> <span class="keyword">try</span> decoder.container(keyedBy: <span class="type">CodingKeys</span>.<span class="keyword">self</span>)</span><br><span class="line">    name <span class="operator">=</span> <span class="keyword">try</span> container.decode(<span class="type">String</span>.<span class="keyword">self</span>, forKey: .name)</span><br><span class="line">    id <span class="operator">=</span> <span class="keyword">try</span> container.decode(<span class="type">Int</span>.<span class="keyword">self</span>, forKey: .id)</span><br><span class="line">    <span class="keyword">let</span> amount <span class="operator">=</span> <span class="keyword">try</span> container.decode(<span class="type">Int</span>.<span class="keyword">self</span>, forKey: .amount)</span><br><span class="line">    <span class="keyword">let</span> tax <span class="operator">=</span> <span class="keyword">try</span> container.decode(<span class="type">Int</span>.<span class="keyword">self</span>, forKey: .tax)</span><br><span class="line">    salary <span class="operator">=</span> <span class="type">Salary</span>(amount: amount, tax: tax)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Inheritance-of-Encodable-Decodable"><a href="#Inheritance-of-Encodable-Decodable" class="headerlink" title="Inheritance of Encodable / Decodable"></a>Inheritance of Encodable / Decodable</h2><p>You have to override the <code>encode</code>  or <code>init:decoder</code> in your subclass and call super before the regular instructions.</p>
<p>For example of encode: <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/48255318/2581637">Code sample from Stack Overflow</a></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicData</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> a: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> b: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">CodingKeys</span>: <span class="title">String</span>, <span class="title">CodingKey</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> a, b</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">encode</span>(<span class="params">to</span> <span class="params">encoder</span>: <span class="type">Encoder</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> container <span class="operator">=</span> encoder.container(keyedBy: <span class="type">CodingKeys</span>.<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">try</span> container.encode(<span class="keyword">self</span>.a, forKey: .a)</span><br><span class="line">        <span class="keyword">try</span> container.encode(<span class="keyword">self</span>.b, forKey: .b)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="function"><span class="keyword">init</span>(<span class="params">from</span> <span class="params">decoder</span>: <span class="type">Decoder</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> container <span class="operator">=</span> <span class="keyword">try</span> decoder.container(keyedBy: <span class="type">CodingKeys</span>.<span class="keyword">self</span>)</span><br><span class="line">        _a <span class="operator">=</span> <span class="keyword">try</span> container.decode(<span class="type">String</span>.<span class="keyword">self</span>, forKey .a)</span><br><span class="line">        _b <span class="operator">=</span> <span class="keyword">try</span> container.decode(<span class="type">Int</span>.<span class="keyword">self</span>, forkey .b)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// In its subclass, you will need to override both encode and init:from.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdditionalData</span>: <span class="title">BasicData</span> </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> c: <span class="type">String</span></span><br><span class="line">    <span class="keyword">let</span> d: <span class="type">Int</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">init</span>(<span class="params">c</span>: <span class="type">String</span>, <span class="params">d</span>: <span class="type">Int</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">self</span>.c <span class="operator">=</span> c</span><br><span class="line">        <span class="keyword">self</span>.d <span class="operator">=</span> d</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">enum</span> <span class="title">CodingKeys</span>: <span class="title">String</span>, <span class="title">CodingKey</span> </span>&#123;</span><br><span class="line">        <span class="keyword">case</span> c, d</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">encode</span>(<span class="params">to</span> <span class="params">encoder</span>: <span class="type">Encoder</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> container <span class="operator">=</span> encoder.container(keyedBy: <span class="type">CodingKeys</span>.<span class="keyword">self</span>)</span><br><span class="line">        <span class="keyword">try</span> container.encode(<span class="keyword">self</span>.c, forKey: .c)</span><br><span class="line">        <span class="keyword">try</span> container.encode(<span class="keyword">self</span>.d, forKey: .d)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> <span class="keyword">super</span>.encode(to: encoder)  <span class="comment">// don&#x27;t forget to call super</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">required</span> <span class="function"><span class="keyword">init</span>(<span class="params">from</span> <span class="params">decoder</span>: <span class="type">Decoder</span>)</span> <span class="keyword">throws</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> container <span class="operator">=</span> <span class="keyword">try</span> decoder.container(keyedBy: <span class="type">CodingKeys</span>.<span class="keyword">self</span>)</span><br><span class="line">        _c <span class="operator">=</span> <span class="keyword">try</span> container.decode(<span class="type">String</span>.<span class="keyword">self</span>, forKey .c)</span><br><span class="line">        _d <span class="operator">=</span> <span class="keyword">try</span> container.decode(<span class="type">Int</span>.<span class="keyword">self</span>, forkey .d)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> <span class="keyword">super</span>.<span class="keyword">init</span>(from: decoder)  <span class="comment">//  don&#x27;t forget to call super</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>NOTE:</strong> When doing research, I found that there is some resource out there that passes <code>container.superEncoder</code> and <code>container.superDecoder</code> into the super class methods. For example: <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/44605696/2581637">swift4 - Using Decodable in Swift 4 with Inheritance - Stack Overflow</a>. However, when I try in my <code>QuestIt</code> project, I found that it will create a new subentry called <code>super: &#123; ... &#125;</code> in serialized JSON, but those are just redundant data because everything inside that super section is already exists in outside super. So that’s not a very good solution. I recommand to pass in <code>encoder</code> or <code>decoder</code> directly to super.</p>
</div></article></div></section><footer><div class="paginator"><a href="/2019/03/03/Todo%20Tags%20In%20Xcode/" class="prev">PREV</a><a href="/2019/01/24/Xcode%20Keyboard%20Shortcut%20Cheatsheet/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'nuynait';
var disqus_identifier = '2019/02/09/Swift 4 Codable/';
var disqus_title = 'Swift 4 Codable';
var disqus_url = 'http://blog.jerryshan.com/2019/02/09/Swift 4 Codable/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//nuynait.disqus.com/count.js" async></script><!-- block copyright--></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>