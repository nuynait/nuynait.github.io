<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Wrong View Size In Decoration · Tianyun Shan</title><meta name="description" content="Wrong View Size In Decoration - Tianyun Shan"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.jerryshan.com/atom.xml" title="Tianyun Shan"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Wrong View Size In Decoration</h1><div class="post-info">May 15, 2019</div><div class="post-content"><p>If you follow <a href="bear://x-callback-url/open-note?id=244D3DEE-2CCB-4B2D-AD67-9A993F476B86-41558-00008768B09928DC&header=Custom%20Cell%20Space%20For%20RecyclerView">this</a> note, you will learn that we can set the in cell space using decoration. If we want to dynamically change the space based on the view’s (cell) size, then we will need to get the <code>view.height</code> property from the * getItemOffsets* function. However, I sometimes get a <code>0</code> when I visit <code>view.height</code> .</p>
<span id="more"></span>

<p>I saw the same problem in <a target="_blank" rel="noopener" href="https://stackoverflow.com/a/53848159/2581637">stackoverflow</a>. So here is what I learned.</p>
<h1 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h1><p>Write a fix layout class. You can probably copy and paste this class into your decorator.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * This function gets from here</span></span><br><span class="line"><span class="comment"> * https://stackoverflow.com/a/53848159/2581637</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Reason: In `getItemOffsets:` the view do not have a correct</span></span><br><span class="line"><span class="comment"> * height for me to calculate the math. After search on web, I</span></span><br><span class="line"><span class="comment"> * found this solution. Calling before getting the height from</span></span><br><span class="line"><span class="comment"> * the view will fix the problem.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> view: View to calculate the size</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> parent: Parent for the view</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">fixLayoutSize</span><span class="params">(view: <span class="type">View</span>, parent: <span class="type">ViewGroup</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (view.layoutParams == <span class="literal">null</span>) &#123;</span><br><span class="line">        view.layoutParams = ViewGroup.LayoutParams(</span><br><span class="line">                ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> widthSpec = View.MeasureSpec.makeMeasureSpec(parent.width, View.MeasureSpec.EXACTLY)</span><br><span class="line">    <span class="keyword">val</span> heightSpec = View.MeasureSpec.makeMeasureSpec(parent.height, View.MeasureSpec.UNSPECIFIED)</span><br><span class="line">    <span class="keyword">val</span> childWidth = ViewGroup.getChildMeasureSpec(</span><br><span class="line">            widthSpec, parent.paddingLeft + parent.paddingRight, view.layoutParams.width</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">val</span> childHeight = ViewGroup.getChildMeasureSpec(</span><br><span class="line">            heightSpec, parent.paddingTop + parent.paddingBottom, view.layoutParams.height</span><br><span class="line">    )</span><br><span class="line">    view.measure(childWidth, childHeight)</span><br><span class="line">    view.layout(<span class="number">0</span>, <span class="number">0</span>, view.measuredWidth, view.measuredHeight)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Now call this function once before you get the width/height from the view.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemOffsets</span><span class="params">(outRect: <span class="type">Rect</span>, view: <span class="type">View</span>, parent: <span class="type">RecyclerView</span>, state: <span class="type">RecyclerView</span>.<span class="type">State</span>)</span></span> &#123;</span><br><span class="line">	fixLayoutSize(view, parent)</span><br><span class="line">	print(view.height) <span class="comment">// correct height</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Note that if you don’t notice any number that is wrong, but just some times have a 0 on height, call <code>fixLayoutSize(view, parent)</code> under if <code>(view.height == 0)</code> to speed up process.</p>
<h1 id="More-Readings"><a href="#More-Readings" class="headerlink" title="More Readings"></a>More Readings</h1><p><a target="_blank" rel="noopener" href="https://yoda.entelect.co.za/view/9627/how-to-android-recyclerview-item-decorations">How to: Android RecyclerView Item Decorations</a>. This could be a very decent reading to understanding this problem more.</p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/05/15/Dynamically%20Get%20Screen%20Element%20Size/" class="prev">PREV</a><a href="/2019/05/13/Device%20Screen%20Size/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2021 <a href="http://blog.jerryshan.com">Tianyun Shan</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>